<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Carrossel infinito A4 + Zoom real</title>

    <style>
        :root{
            --gapX: 100px;
            --tiltY: 14deg;
            --depth: 120px;
            --sideScale: 0.88;
            --centerScale: 1.0;
            --lift: 0px;
        }

        *{ box-sizing:border-box; }

        body{
            margin:0;
            font-family:system-ui, sans-serif;
            background:#0f1220;
            color:#fff;
        }

        /* ===== CARROSSEL ===== */
        .carousel{
            position:relative;
            width:96vw;
            height:80vh;
            margin:40px auto;
            border-radius:18px;
            background:#14182e;
            overflow:hidden;
        }
        .viewport{
            position:absolute;
            inset:0;
            perspective:1100px;
            perspective-origin: 50% 40%;
        }
        .belt{
            position:relative;
            width:100%;
            height:100%;
            transform-style:preserve-3d;
        }
        .pageImg{
            position:absolute;
            top:50%;
            left:50%;
            max-width:25vw;
            max-height:72vh;
            width:auto;
            height:auto;
            background:#fff;
            border-radius:10px;
            box-shadow:0 12px 28px rgba(0,0,0,.30);
            transform-style:preserve-3d;
            transition:transform .42s cubic-bezier(.2,.9,.2,1), filter .25s ease;
            cursor:default;
            user-select:none;
            -webkit-user-drag:none;
        }
        .pageImg[data-active="true"]{
            filter:brightness(1.05);
            cursor:zoom-in;
        }

        /* ===== SETAS ===== */
        .controls{
            position:absolute;
            inset:0;
            pointer-events:none;
        }
        .controls button{
            pointer-events:auto;
            position:absolute;
            top:50%;
            transform:translateY(-50%);
            border:none;
            background:rgba(0,0,0,.6);
            color:#fff;
            width:52px;
            height:52px;
            border-radius:50%;
            cursor:pointer;
            font-size:22px;
        }
        #prev{ left:12px; }
        #next{ right:12px; }

        /* ===== MODAL ===== */
        .modal{
            position:fixed;
            inset:0;
            display:none;
            background:rgba(0,0,0,.7);
            z-index:999;
        }
        .modal.open{ display:block; }

        .modalContent{
            position:absolute;
            inset:40px;
            background:#111;
            border-radius:16px;
            display:flex;
            flex-direction:column;
        }
        .modalTop{
            padding:10px;
            display:flex;
            justify-content:flex-end;
            gap:8px;
        }
        .modalTop button{
            background:#222;
            border:none;
            color:#fff;
            padding:8px 12px;
            border-radius:8px;
            cursor:pointer;
        }

        /* ===== ZOOM REAL + PAN ===== */
        .modalCanvas{
            flex:1;
            overflow:auto;
            background:#000;

            cursor:grab;
            user-select:none;
            touch-action:none;
        }
        .modalCanvas.grabbing{ cursor:grabbing; }

        .modalCanvas img{
            display:block;
            margin:auto;
            pointer-events:none;
            user-select:none;
            -webkit-user-drag:none;
        }
    </style>
</head>

<body>

<div class="carousel">
    <div class="viewport">
        <div class="belt" id="belt">
            <img class="pageImg" src="./img/1.png" alt="1" draggable="false">
            <img class="pageImg" src="./img/2.png" alt="2" draggable="false">
            <img class="pageImg" src="./img/3.png" alt="3" draggable="false">
            <img class="pageImg" src="./img/4.png" alt="4" draggable="false">
            <img class="pageImg" src="./img/5.png" alt="5" draggable="false">
            <img class="pageImg" src="./img/6.png" alt="6" draggable="false">
            <img class="pageImg" src="./img/7.png" alt="7" draggable="false">
        </div>
    </div>

    <div class="controls">
        <button id="prev">◀</button>
        <button id="next">▶</button>
    </div>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
    <div class="modalContent">
        <div class="modalTop">
            <button id="zoomOut">−</button>
            <button id="zoomIn">+</button>
            <button id="close">✕</button>
        </div>
        <div class="modalCanvas" id="canvas">
            <img id="modalImg" draggable="false" alt="zoom">
        </div>
    </div>
</div>

<script>
    (() => {
        const pages = [...document.querySelectorAll('.pageImg')];
        const belt = document.getElementById('belt');

        const modal = document.getElementById('modal');
        const modalImg = document.getElementById('modalImg');
        const canvas = document.getElementById('canvas');

        const mod = (n,m)=>((n % m) + m) % m;

        // índice real infinito
        let activeReal = 0; // começa na imagem 1

        // ===== CARROSSEL (infinito de verdade) =====
        function render(){
            const n = pages.length;
            const activeIndex = mod(activeReal, n);
            const half = Math.floor(n/2);

            const root = getComputedStyle(document.documentElement);
            const gapX = parseFloat(root.getPropertyValue('--gapX')) || 100;
            const tiltY = parseFloat(root.getPropertyValue('--tiltY')) || 14;
            const depth = parseFloat(root.getPropertyValue('--depth')) || 120;
            const sideScale = parseFloat(root.getPropertyValue('--sideScale')) || 0.88;
            const centerScale = parseFloat(root.getPropertyValue('--centerScale')) || 1.0;
            const lift = parseFloat(root.getPropertyValue('--lift')) || 0;

            pages.forEach((img, i) => {
                // diferença circular sempre em [-half, +half]
                let d = i - activeIndex;
                if (d >  half) d -= n;
                if (d < -half) d += n;

                const abs = Math.abs(d);
                const dir = Math.sign(d);

                const x = d * gapX;
                const y = (d === 0) ? -lift : 0;
                const z = -abs * depth;
                const rotY = (d === 0) ? 0 : (-dir * tiltY);
                const sc = (d === 0) ? centerScale : sideScale;

                img.dataset.active = (d === 0) ? "true" : "false";
                img.style.zIndex = String(1000 - abs);

                img.style.transform =
                    `translate(-50%,-50%) translate3d(${x}px, ${y}px, ${z}px) rotateY(${rotY}deg) scale(${sc})`;

                img.style.filter = (d === 0) ? 'none' : `brightness(${0.92 - abs*0.03})`;
            });
        }

        function go(delta){
            activeReal += delta;
            render();
        }

        document.getElementById('prev').onclick = ()=> go(-1);
        document.getElementById('next').onclick = ()=> go(1);

        // wheel do carrossel (navega infinito sem deslocar)
        let wheelLock = false;
        belt.addEventListener('wheel', (e) => {
            if (modal.classList.contains('open')) return;
            e.preventDefault();

            if (wheelLock) return;
            wheelLock = true;
            setTimeout(() => wheelLock = false, 90);

            const use = Math.abs(e.deltaX) > Math.abs(e.deltaY) ? e.deltaX : e.deltaY;
            if (use > 0) go(1);
            else go(-1);
        }, { passive:false });

        // ===== MODAL =====
        let zoom = 1;
        let baseW = 0;
        let baseH = 0;
        const minZoom = 0.3;
        const maxZoom = 8;

        pages.forEach(img=>{
            img.onclick = () => {
                // sem clique lateral: só abre se for a central
                if (img.dataset.active !== "true") return;

                modalImg.src = img.src;
                modal.classList.add('open');
                zoom = 1;

                modalImg.onload = () => {
                    baseW = modalImg.naturalWidth;
                    baseH = modalImg.naturalHeight;
                    applyZoom();
                };
            };
        });

        document.getElementById('close').onclick = closeModal;
        modal.onclick = (e)=>{ if (e.target === modal) closeModal(); };
        function closeModal(){ modal.classList.remove('open'); }

        function applyZoom(){
            modalImg.style.width  = (baseW * zoom) + 'px';
            modalImg.style.height = (baseH * zoom) + 'px';
        }

        document.getElementById('zoomIn').onclick = ()=>{ zoom = Math.min(maxZoom, zoom * 1.2); applyZoom(); };
        document.getElementById('zoomOut').onclick = ()=>{ zoom = Math.max(minZoom, zoom / 1.2); applyZoom(); };

        // ===== ZOOM NO SCROLL (APENAS NO MODAL) =====
        canvas.addEventListener('wheel', (e) => {
            if (!modal.classList.contains('open')) return;

            // evita a página/scroll normal enquanto zooma
            e.preventDefault();

            // deltaY < 0 = aproxima, > 0 = afasta
            const factor = (e.deltaY < 0) ? 1.08 : (1 / 1.08);
            zoom = Math.min(maxZoom, Math.max(minZoom, zoom * factor));
            applyZoom();
        }, { passive:false });

        // ===== PAN (segurar e arrastar) =====
        let isPanning = false;
        let startX = 0, startY = 0;
        let startScrollLeft = 0, startScrollTop = 0;

        canvas.addEventListener('pointerdown', (e) => {
            if (e.button !== 0) return;
            e.preventDefault();

            isPanning = true;
            canvas.classList.add('grabbing');

            startX = e.clientX;
            startY = e.clientY;
            startScrollLeft = canvas.scrollLeft;
            startScrollTop = canvas.scrollTop;

            canvas.setPointerCapture(e.pointerId);
        });

        canvas.addEventListener('pointermove', (e) => {
            if (!isPanning) return;

            const dx = e.clientX - startX;
            const dy = e.clientY - startY;

            canvas.scrollLeft = startScrollLeft - dx;
            canvas.scrollTop  = startScrollTop  - dy;
        });

        canvas.addEventListener('pointerup', (e) => {
            isPanning = false;
            canvas.classList.remove('grabbing');
            try { canvas.releasePointerCapture(e.pointerId); } catch {}
        });

        canvas.addEventListener('pointercancel', () => {
            isPanning = false;
            canvas.classList.remove('grabbing');
        });

        render();
    })();
</script>

</body>
</html>
