<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Carrossel infinito A4 + Zoom real</title>

    <style>
        :root{
            --gapX: 100px;
            --tiltY: 14deg;
            --depth: 120px;
            --sideScale: 0.88;
            --centerScale: 1.0;
            --lift: 0px;
        }

        *{ box-sizing:border-box; }

        body{
            margin:0;
            font-family:system-ui, sans-serif;
            background:#0f1220;
            color:#fff;
        }

        /* ===== CARROSSEL ===== */
        .carousel{
            position:relative;
            width:96vw;
            height:80vh;
            margin:40px auto;
            border-radius:18px;
            background:#14182e;
            overflow:hidden;

            /* reserva espaço visual pro rodapé integrado */
            padding-bottom: 150px;
        }
        .viewport{
            position:absolute;
            inset:0;
            perspective:1100px;
            perspective-origin: 50% 40%;
        }
        .belt{
            position:relative;
            width:100%;
            height:100%;
            transform-style:preserve-3d;
        }
        .pageImg{
            position:absolute;
            top:50%;
            left:50%;
            max-width:25vw;
            max-height:72vh;
            width:auto;
            height:auto;
            background:#fff;
            border-radius:10px;
            box-shadow:0 12px 28px rgba(0,0,0,.30);
            transform-style:preserve-3d;
            transition:transform .42s cubic-bezier(.2,.9,.2,1), filter .25s ease;
            cursor:default;
            user-select:none;
            -webkit-user-drag:none;
        }
        .pageImg[data-active="true"]{
            filter:brightness(1.05);
            cursor:zoom-in;
        }

        /* ===== SETAS ===== */
        .controls{
            position:absolute;
            inset:0;
            pointer-events:none;
            z-index: 20;
        }
        .controls button{
            pointer-events:auto;
            position:absolute;
            top:50%;
            transform:translateY(-50%);
            border:none;
            background:rgba(0,0,0,.6);
            color:#fff;
            width:52px;
            height:52px;
            border-radius:50%;
            cursor:pointer;
            font-size:22px;
        }
        #prev{ left:12px; }
        #next{ right:12px; }

        /* ===== RODAPÉ INTEGRADO (dentro do carrossel) ===== */
        .carouselInfo{
            position:absolute;
            left:0;
            right:0;
            bottom:0;
            z-index: 15;

            padding: 14px 14px 16px;
            background: linear-gradient(
                    to top,
                    rgba(0,0,0,.72) 0%,
                    rgba(0,0,0,.50) 55%,
                    rgba(0,0,0,0) 100%
            );
            backdrop-filter: blur(6px);
        }

        .carouselText{
            display:flex;
            flex-direction:column;
            gap:6px;
            margin-bottom:10px;
            max-width: 980px;
        }
        .carouselTitle{
            margin:0;
            font-size:18px;
            font-weight:700;
        }
        .carouselDesc{
            margin:0;
            opacity:.88;
            line-height:1.35;
            font-size:14px;
        }

        .carouselDots{
            display:flex;
            justify-content:center;
            gap:8px;
            margin: 10px 0 12px;
        }
        .carouselDot{
            width:10px;
            height:10px;
            border-radius:999px;
            border:none;
            cursor:pointer;
            background:rgba(255,255,255,.35);
            transition:all .25s ease;
        }
        .carouselDot.active{
            width:34px;
            background:rgba(255,255,255,.92);
        }

        .carouselLabels{
            display:flex;
            flex-wrap:wrap;
            gap:8px;
            justify-content:center;
        }
        .carouselLabel{
            border:none;
            cursor:pointer;
            padding:10px 12px;
            border-radius:10px;
            background:rgba(255,255,255,.10);
            color:#fff;
            font-weight:600;
            font-size:13px;
            border:1px solid rgba(255,255,255,.14);
            transition:all .25s ease;
        }
        .carouselLabel.active{
            background:rgba(255,255,255,.18);
            border-color:rgba(255,255,255,.24);
        }

        /* ===== MODAL ===== */
        .modal{
            position:fixed;
            inset:0;
            display:none;
            background:rgba(0,0,0,.7);
            z-index:999;
        }
        .modal.open{ display:block; }

        .modalContent{
            position:absolute;
            inset:40px;
            background:#111;
            border-radius:16px;
            display:flex;
            flex-direction:column;
        }
        .modalTop{
            padding:10px;
            display:flex;
            justify-content:flex-end;
            gap:8px;
        }
        .modalTop button{
            background:#222;
            border:none;
            color:#fff;
            padding:8px 12px;
            border-radius:8px;
            cursor:pointer;
        }

        /* ===== ZOOM REAL + PAN ===== */
        .modalCanvas{
            flex:1;
            overflow:auto;
            background:#000;

            cursor:grab;
            user-select:none;
            touch-action:none; /* necessário p/ pinch + pan manual */
        }
        .modalCanvas.grabbing{ cursor:grabbing; }

        .modalCanvas img{
            display:block;
            margin:auto;
            pointer-events:none;
            user-select:none;
            -webkit-user-drag:none;
        }

        /* ===== AJUSTE PARA CELULAR EM PÉ (PORTRAIT) ===== */
        @media (max-width: 768px) and (orientation: portrait) {

            :root{
                --gapX: 42px;
                --depth: 70px;
                --tiltY: 8deg;
                --sideScale: 0.92;
            }

            .carousel{
                height: 78vh;
                padding-bottom: 175px; /* rodapé ocupa mais no mobile */
            }

            .pageImg{
                max-width: 68vw;
                max-height: 70vh;
            }

            /* setas centralizadas */
            .controls button{
                top: 50%;
                transform: translateY(-50%);
                width:48px;
                height:48px;
            }

            #prev{ left: 14px; }
            #next{ right: 14px; }

            .carouselTitle{ font-size:16px; }
            .carouselDesc{ font-size:13px; }
            .carouselLabel{ padding:9px 10px; font-size:12px; }
        }

        @media (max-width: 420px) and (orientation: portrait) {
            :root{
                --gapX: 34px;
                --depth: 60px;
            }
        }

        @media (max-width: 768px) and (orientation: portrait){
            .belt{ touch-action: pan-y; }
        }
    </style>
</head>

<body>

<div class="carousel">
    <div class="viewport">
        <div class="belt" id="belt">
            <img class="pageImg" src="./img/1.png" alt="1" draggable="false">
            <img class="pageImg" src="./img/2.png" alt="2" draggable="false">
            <img class="pageImg" src="./img/3.png" alt="3" draggable="false">
            <img class="pageImg" src="./img/4.png" alt="4" draggable="false">
            <img class="pageImg" src="./img/5.png" alt="5" draggable="false">
            <img class="pageImg" src="./img/6.png" alt="6" draggable="false">
            <img class="pageImg" src="./img/7.png" alt="7" draggable="false">
        </div>
    </div>

    <div class="controls">
        <button id="prev">◀</button>
        <button id="next">▶</button>
    </div>

    <!-- ===== RODAPÉ INTEGRADO (dentro do carrossel) ===== -->
    <div class="carouselInfo" id="carouselInfo">
        <div class="carouselText">
            <h3 class="carouselTitle" id="carouselTitle">Página 1</h3>
            <p class="carouselDesc" id="carouselDesc">Descrição da Página 1.</p>
        </div>

        <div class="carouselDots" id="carouselDots" aria-label="Navegação por bolinhas"></div>
        <div class="carouselLabels" id="carouselLabels" aria-label="Navegação por botões"></div>
    </div>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
    <div class="modalContent">
        <div class="modalTop">
            <button id="zoomOut">−</button>
            <button id="zoomIn">+</button>
            <button id="close">✕</button>
        </div>
        <div class="modalCanvas" id="canvas">
            <img id="modalImg" draggable="false" alt="zoom">
        </div>
    </div>
</div>

<script>
    (() => {
        const pages = [...document.querySelectorAll('.pageImg')];
        const belt = document.getElementById('belt');

        const modal = document.getElementById('modal');
        const modalImg = document.getElementById('modalImg');
        const canvas = document.getElementById('canvas');

        const mod = (n,m)=>((n % m) + m) % m;

        // ===== TÍTULO + DESCRIÇÃO (edite como quiser) =====
        const pageMeta = [
            { title: "Página 1", desc: "Descrição da Página 1." },
            { title: "Página 2", desc: "Descrição da Página 2." },
            { title: "Página 3", desc: "Descrição da Página 3." },
            { title: "Página 4", desc: "Descrição da Página 4." },
            { title: "Página 5", desc: "Descrição da Página 5." },
            { title: "Página 6", desc: "Descrição da Página 6." },
            { title: "Página 7", desc: "Descrição da Página 7." },
        ];

        const titleEl = document.getElementById('carouselTitle');
        const descEl = document.getElementById('carouselDesc');
        const dotsWrap = document.getElementById('carouselDots');
        const labelsWrap = document.getElementById('carouselLabels');
        const carouselInfo = document.getElementById('carouselInfo');

        // índice real infinito
        let activeReal = 0; // começa na imagem 1

        // ===== AUTOPLAY =====
        let autoplay = true;
        let autoplayTimer = null;

        function stopAutoplay(){
            if (autoplayTimer) clearInterval(autoplayTimer);
            autoplayTimer = null;
        }

        function startAutoplay(){
            stopAutoplay();
            autoplayTimer = setInterval(() => {
                if (!autoplay) return;
                if (modal.classList.contains('open')) return;
                go(1);
            }, 4500);
        }

        function userInteracted(){
            autoplay = false;
            setTimeout(() => { autoplay = true; }, 9000);
        }

        function setActiveByIndex(index){
            activeReal = index;
            render();
            userInteracted();
        }

        function updateInfo(activeIndex){
            const meta = pageMeta[activeIndex] || { title: `Página ${activeIndex+1}`, desc: "" };
            if (titleEl) titleEl.textContent = meta.title;
            if (descEl) descEl.textContent = meta.desc;

            if (dotsWrap){
                [...dotsWrap.children].forEach((b, i) => b.classList.toggle('active', i === activeIndex));
            }
            if (labelsWrap){
                [...labelsWrap.children].forEach((b, i) => b.classList.toggle('active', i === activeIndex));
            }
        }

        // cria bolinhas e botões (1 vez)
        if (dotsWrap){
            dotsWrap.innerHTML = '';
            pages.forEach((_, i) => {
                const b = document.createElement('button');
                b.type = 'button';
                b.className = 'carouselDot';
                b.setAttribute('aria-label', `Ir para ${pageMeta[i]?.title || `Página ${i+1}`}`);
                b.addEventListener('click', (e) => { e.stopPropagation(); setActiveByIndex(i); });
                dotsWrap.appendChild(b);
            });
        }

        if (labelsWrap){
            labelsWrap.innerHTML = '';
            pages.forEach((_, i) => {
                const b = document.createElement('button');
                b.type = 'button';
                b.className = 'carouselLabel';
                b.textContent = pageMeta[i]?.title || `Página ${i+1}`;
                b.addEventListener('click', (e) => { e.stopPropagation(); setActiveByIndex(i); });
                labelsWrap.appendChild(b);
            });
        }

        // evita que clique no rodapé integrado dispare ações do carrossel
        carouselInfo?.addEventListener('click', (e) => e.stopPropagation());

        // ===== CARROSSEL (infinito de verdade) =====
        function render(){
            const n = pages.length;
            const activeIndex = mod(activeReal, n);
            const half = Math.floor(n/2);

            const root = getComputedStyle(document.documentElement);
            const gapX = parseFloat(root.getPropertyValue('--gapX')) || 100;
            const tiltY = parseFloat(root.getPropertyValue('--tiltY')) || 14;
            const depth = parseFloat(root.getPropertyValue('--depth')) || 120;
            const sideScale = parseFloat(root.getPropertyValue('--sideScale')) || 0.88;
            const centerScale = parseFloat(root.getPropertyValue('--centerScale')) || 1.0;
            const lift = parseFloat(root.getPropertyValue('--lift')) || 0;

            pages.forEach((img, i) => {
                let d = i - activeIndex;
                if (d >  half) d -= n;
                if (d < -half) d += n;

                const abs = Math.abs(d);
                const dir = Math.sign(d);

                const x = d * gapX;
                const y = (d === 0) ? -lift : 0;
                const z = -abs * depth;
                const rotY = (d === 0) ? 0 : (-dir * tiltY);
                const sc = (d === 0) ? centerScale : sideScale;

                img.dataset.active = (d === 0) ? "true" : "false";
                img.style.zIndex = String(1000 - abs);

                img.style.transform =
                    `translate(-50%,-50%) translate3d(${x}px, ${y}px, ${z}px) rotateY(${rotY}deg) scale(${sc})`;

                img.style.filter = (d === 0) ? 'none' : `brightness(${0.92 - abs*0.03})`;
            });

            updateInfo(activeIndex);
        }

        function go(delta){
            activeReal += delta;
            render();
        }

        document.getElementById('prev').onclick = ()=> { userInteracted(); go(-1); };
        document.getElementById('next').onclick = ()=> { userInteracted(); go(1); };

        // wheel do carrossel
        let wheelLock = false;
        belt.addEventListener('wheel', (e) => {
            if (modal.classList.contains('open')) return;
            e.preventDefault();

            userInteracted();

            if (wheelLock) return;
            wheelLock = true;
            setTimeout(() => wheelLock = false, 90);

            const use = Math.abs(e.deltaX) > Math.abs(e.deltaY) ? e.deltaX : e.deltaY;
            if (use > 0) go(1);
            else go(-1);
        }, { passive:false });

        // swipe no celular
        let swipeStartX = null;
        let swipeStartY = null;
        let swipeStartT = 0;

        belt.addEventListener('touchstart', (e) => {
            if (modal.classList.contains('open')) return;
            if (!e.touches || e.touches.length !== 1) return;

            swipeStartX = e.touches[0].clientX;
            swipeStartY = e.touches[0].clientY;
            swipeStartT = Date.now();
        }, { passive: true });

        belt.addEventListener('touchend', (e) => {
            if (modal.classList.contains('open')) return;
            if (swipeStartX == null || swipeStartY == null) return;

            const t = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0] : null;
            if (!t) return;

            const endX = t.clientX;
            const endY = t.clientY;

            const dx = endX - swipeStartX;
            const dy = endY - swipeStartY;
            const dt = Date.now() - swipeStartT;

            swipeStartX = swipeStartY = null;

            if (Math.abs(dx) < Math.abs(dy)) return;

            const MIN_DIST = 35;
            const MAX_TIME = 700;

            if (Math.abs(dx) < MIN_DIST) return;
            if (dt > MAX_TIME) return;

            userInteracted();

            if (dx < 0) go(1);
            else go(-1);
        }, { passive: true });

        // ===== MODAL =====
        let zoomFactor = 1;
        let baseW = 0;
        let baseH = 0;
        let baseScale = 1;
        const minZoomFactor = 1;
        const maxZoomFactor = 8;

        function computeBaseScaleFit(){
            const margin = 24;
            const cw = Math.max(1, canvas.clientWidth - margin * 2);
            const ch = Math.max(1, canvas.clientHeight - margin * 2);
            const fit = Math.min(cw / baseW, ch / baseH, 1);
            baseScale = fit;
        }

        function applyZoom(){
            const scale = baseScale * zoomFactor;
            modalImg.style.width  = (baseW * scale) + 'px';
            modalImg.style.height = (baseH * scale) + 'px';
        }

        pages.forEach(img=>{
            img.onclick = () => {
                if (img.dataset.active !== "true") return;

                modalImg.src = img.src;
                modal.classList.add('open');

                zoomFactor = 1;

                modalImg.onload = () => {
                    baseW = modalImg.naturalWidth || 1;
                    baseH = modalImg.naturalHeight || 1;

                    computeBaseScaleFit();
                    applyZoom();

                    requestAnimationFrame(() => {
                        canvas.scrollTop  = (canvas.scrollHeight - canvas.clientHeight) / 2;
                        canvas.scrollLeft = (canvas.scrollWidth - canvas.clientWidth) / 2;
                    });
                };
            };
        });

        document.getElementById('close').onclick = closeModal;
        modal.onclick = (e)=>{ if (e.target === modal) closeModal(); };
        function closeModal(){ modal.classList.remove('open'); }

        document.getElementById('zoomIn').onclick = ()=> {
            zoomFactor = Math.min(maxZoomFactor, zoomFactor * 1.2);
            applyZoom();
        };
        document.getElementById('zoomOut').onclick = ()=> {
            zoomFactor = Math.max(minZoomFactor, zoomFactor / 1.2);
            applyZoom();
        };

        window.addEventListener('resize', () => {
            if (!modal.classList.contains('open')) return;
            computeBaseScaleFit();
            applyZoom();
        });

        canvas.addEventListener('wheel', (e) => {
            if (!modal.classList.contains('open')) return;
            e.preventDefault();

            const factor = (e.deltaY < 0) ? 1.08 : (1 / 1.08);
            zoomFactor = Math.min(maxZoomFactor, Math.max(minZoomFactor, zoomFactor * factor));
            applyZoom();
        }, { passive:false });

        // pan com mouse
        let isPanningMouse = false;
        let startX = 0, startY = 0;
        let startScrollLeft = 0, startScrollTop = 0;

        canvas.addEventListener('pointerdown', (e) => {
            if (e.pointerType !== 'mouse') return;
            if (e.button !== 0) return;
            e.preventDefault();

            isPanningMouse = true;
            canvas.classList.add('grabbing');

            startX = e.clientX;
            startY = e.clientY;
            startScrollLeft = canvas.scrollLeft;
            startScrollTop = canvas.scrollTop;

            canvas.setPointerCapture(e.pointerId);
        });

        canvas.addEventListener('pointermove', (e) => {
            if (!isPanningMouse) return;

            const dx = e.clientX - startX;
            const dy = e.clientY - startY;

            canvas.scrollLeft = startScrollLeft - dx;
            canvas.scrollTop  = startScrollTop  - dy;
        });

        canvas.addEventListener('pointerup', (e) => {
            isPanningMouse = false;
            canvas.classList.remove('grabbing');
            try { canvas.releasePointerCapture(e.pointerId); } catch {}
        });

        canvas.addEventListener('pointercancel', () => {
            isPanningMouse = false;
            canvas.classList.remove('grabbing');
        });

        // pinch + pan 1 dedo
        let tPanning = false;
        let tStartX = 0, tStartY = 0;
        let tStartScrollLeft = 0, tStartScrollTop = 0;

        let pinching = false;
        let pinchStartDist = 0;
        let pinchStartZoom = 1;

        function dist(t1, t2){
            const dx = t2.clientX - t1.clientX;
            const dy = t2.clientY - t1.clientY;
            return Math.hypot(dx, dy);
        }

        canvas.addEventListener('touchstart', (e) => {
            if (!modal.classList.contains('open')) return;

            if (e.touches.length === 1){
                pinching = false;
                tPanning = true;

                tStartX = e.touches[0].clientX;
                tStartY = e.touches[0].clientY;
                tStartScrollLeft = canvas.scrollLeft;
                tStartScrollTop = canvas.scrollTop;
            }

            if (e.touches.length === 2){
                tPanning = false;
                pinching = true;

                pinchStartDist = dist(e.touches[0], e.touches[1]);
                pinchStartZoom = zoomFactor;
            }
        }, { passive: true });

        canvas.addEventListener('touchmove', (e) => {
            if (!modal.classList.contains('open')) return;

            if (pinching && e.touches.length === 2){
                e.preventDefault();

                const d = dist(e.touches[0], e.touches[1]);
                if (pinchStartDist <= 0) return;

                const ratio = d / pinchStartDist;
                zoomFactor = Math.min(maxZoomFactor, Math.max(minZoomFactor, pinchStartZoom * ratio));
                applyZoom();
                return;
            }

            if (tPanning && e.touches.length === 1){
                e.preventDefault();

                const dx = e.touches[0].clientX - tStartX;
                const dy = e.touches[0].clientY - tStartY;

                canvas.scrollLeft = tStartScrollLeft - dx;
                canvas.scrollTop  = tStartScrollTop  - dy;
            }
        }, { passive: false });

        canvas.addEventListener('touchend', (e) => {
            if (e.touches.length === 0){
                tPanning = false;
                pinching = false;
            }
            if (e.touches.length === 1){
                pinching = false;
                tPanning = true;

                tStartX = e.touches[0].clientX;
                tStartY = e.touches[0].clientY;
                tStartScrollLeft = canvas.scrollLeft;
                tStartScrollTop = canvas.scrollTop;
            }
        }, { passive: true });

        render();
        startAutoplay();
    })();
</script>

</body>
</html>
